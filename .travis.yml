sudo: required
dist: xenial
language: python
python: '2.7'
before_install:
- sudo apt-get update -qq
- sudo apt-get install -qq python-apt
- pip install ansible-vault
- openssl aes-256-cbc -k "$vault_file_pass" -in tests/.vault_pass.enc -out tests/.vault_pass.txt -d
- "${TRAVIS_BUILD_DIR}/.travis/crypting.sh decrypt"
install:
- pip install ansible
- "{ echo '[defaults]'; echo 'roles_path = ../'; } >> ansible.cfg"
script:
- ANSIBLE_VAULT_PASSWORD_FILE=tests/.vault_pass.txt ansible-playbook -i tests/inventory
  tests/test.yml --syntax-check
- ANSIBLE_VAULT_PASSWORD_FILE=tests/.vault_pass.txt ansible-playbook -i tests/inventory
  tests/test.yml --connection=local --sudo
- 'ANSIBLE_VAULT_PASSWORD_FILE=tests/.vault_pass.txt ansible-playbook -i tests/inventory
  tests/test.yml --connection=local --sudo | grep -q ''changed=0.*failed=0'' && (echo
  ''Idempotence test: pass'' && exit 0) || (echo ''Idempotence test: fail'' && exit
  1)'
- "[ -e /etc/ddclient/ddclient.conf ] && (echo 'ddclient.conf was created correctly.'
  && exit 0) || (echo 'ddclient.conf was not created.' && exit 1)"
- "[ -e /usr/sbin/ddclient ] && (echo 'ddclient binary is installed.' && exit 0) ||
  (echo 'ddclient binary is not installed' && exit 1)"
- (sudo ddclient -exec -debug | awk '{ print $1 }' | while IFS= read -r lines; do
  if [[ "$lines" != *"DEBUG:"* ]]; then echo "Failed!"; exit 1; fi done)
after_script:
- "${TRAVIS_BUILD_DIR}}/.travis/crypted.sh clean"
- shred tests/.vault_pass.txt
notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: kK0MF6AhyPLEXkhFFjneCKbtmddeZnD3XbRHWUYqkIhKuwBaNq0q52mrHYug4X3xDYW4n84gFqUjcUoazA5X80WRp4KseVejKNShQ7zZDwiapneWRVxUbgvr0Xet5rLmgDP5qDnoiGOz2BDIJAn04HCgULwG5cZfeBJVJIR84leRixyl8MmomgvBEHV6hvwrbSdEGLP4ilaD5OgFJOE7bgyzcd9gyQ5AQclChTGqMRCibNpRwe0jbMRvGpFVCzewMSS4LapSfwCV8rRj+6P59pO44chmyiM9lADZg0O0JVhyp6RnyCgF/Ocg35XQ2tadInjy8Nlft73hpwo/b5zGn7UXxT0d7sXEYGGJbn5gZ8BUuzougLKZ9n3kGvXUEBF0J1mBYYhpLS3ue+hVQgdHhMV/Rl+GpBZWmuX2IzlIV611q+8OtsXPzO0uCYhM8BgXTSu8iiA4Jn2AoC5zNRcN5QPlZFcr73sKG8KjcG74YI+6Nb9HqflmrOawL2SLjWCNl2PFgkeyT/twBRYtpaT/ruTKuS9Q6drDIeKtEtJbnPIN/DAnTZq7m5kMWVBUaTtUpFMNM5/DTlgyTne2iB00hXibbfQ7i0epzfUYffYkvfhzC5LRk+/bq9iyIG4wpksFkwsGmHFTk2Pkiveb2ganWRY83zbLqtJ9CLlwGoUtYUw=
env:
  global:
    secure: vzIzpI/Vsw/CPAItlsT94f4fSI3VQt61EBgS5lA6ijDNvQ9mJdClq470SH+hJGPfOJpigTMOtIYSrylNobW8hTvznClHQDZBDraJd48z2vpnWwi6XSaYvKAZH5Y5ftpAlZTeaqIssU2Xdj/zl4BFTibVQsHH2FFT6ReMeLtgncsYeZuC9QE6rMEhNGYH4i1NTXo4xDoGCSOSdu0WUYDmJC6zuun4KhzpuUUKNe3iabQounekf0S9IV+G/FrS+i6U+TdugfPvhZa61Be6AaBYALnDCi9ozjEboMAd4lTICvTV3kSSAicDMC+DPyCWrDA7ZJ05c1yCp4Bu4eyWtV3o6KDdZ4nEpJ3Q1DcFfM12guWUnDoMFtFjR5LwwXEfRV351SA2Ij62zeIOnzsYAs6qhymqVspPlLEs+umuseE8jDtoxrrhH7H/QIurDon58RGVF4Kdw8VXfN733Km6+/h8zGgtETVWn0zPFv8H/olG6ubqElf+pFtkkf1I3L23+lmRk7ox5mM4LRzAapCqNfzRG08GZicGpA46Ta3jiqPVIJ/U5RpnF/rVsAPgzLnqN2mWx1BjLeN9oM9BuPx6QCX1/yQAGBWJReDEvtWYKiO2Ckhvetjln69kJdTnFRgoNH+jFREqXVh2ydUT5RfziBF2jaDJzYTPkpKfIWF/FgniYuE=
